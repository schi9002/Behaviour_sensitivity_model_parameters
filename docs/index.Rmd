---
title: "Supplementary material - S3: Behaviour sensitivity test"
author: "Simon Chiu"
date: "`r Sys.Date()`"
output:
  rmdformats::robobook:
---

```{r setup, include=FALSE}
# knitr::opts_chunk$set(echo = TRUE)

rm(list=ls())
gc()

library(progress)
library(tidyverse)
library(openxlsx)
library(ggplot2)
library(patchwork)
library(ggh4x)
library(ggpubr)
library(scales)
library(kableExtra)

lsa.bmi.df.time.series.diff.derv<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_bmi_df_time_series_diff_derv.RDS")

```


```{r, echo=F, message=F, error=F, warning=F}
lsa.bmi.df.time.series.diff.derv.summary<-lsa.bmi.df.time.series.diff.derv %>% 
  group_by() %>% 
  filter(year==2057) %>% 
group_by(focus,focus.title,
           bmi.input, age.groups.input, gender.input, 
           bmi.output, age.groups.output, gender.output) %>% 
  summarise(mean_cum_sum_diff=mean(cum_sum_diff_value, na.rm=T),
            mean_cum_sum_diff.der_value=mean(cum_sum_diff.der_value, na.rm=T),
            max_cum_sum_diff_value=max(cum_sum_diff_value, na.rm=T),
            mean_cum_sum_diff.der_value=max(cum_sum_diff.der_value, na.rm=T)) %>% ungroup()
```


# Introduction
This document presents the results assessing the impact of input assumptions on model behaviour for the **D**c**i**sion **S**upport tool for **C**hild and **A**dolescence **O**besity, a system dynamic model developed to explore underlying relationships that contribute to youth obesity.

## Outline of behaviour sensitivity analysis

System dynamics models are described as being "causally-descriptive", meaning that unlike other "black-box", it is not sufficient that system dynamics only produce accurate output. In addition to being numerically valid, system dynamics models' behaviour needs to be validated.

The test presented in this document examines which input assumptions have the greatest impact on model behaviour, unlike previous sensitivity analysis, which focuses on numerical relationships between input assumptions and outputs (either model outcomes or policy outcomes).

# Methods

A sensitivity analysis was conducted testing 649 input variables between $\pm$ 20% of an input's initial value. While each input value may have more extreme values, these input values are considered to be outside of probable values. For each sensitivity analysis, the model generates 78 BMI prevalence outcomes, 3 BMI categories, 13 age groups and two genders. 

Model behaviour is the trend, phase, lag or amplitude of a system dynamic model result over modelled time. Inputs that impact these outcome characteristics are considered to impact the model behaviour.

## Outcome Measure

The behaviour of each model test was evaluated using the cumulative difference of the first derivative. The following plots explain how this outcome measure is calculated.

Figure panel A shows a plot of three outcomes, the base model, with no changes to any initial assumptions. The result varies an input assumption that produces similar model behaviour and a second test, where varying the input assumption produces different model behaviour. The absolute cumulative difference between the model outcomes is plotted in panel C. 

Panel B plots the first derivative of each model result. The model results with similar behaviour also have a similar first derivative. Conversely, the different behaviour result has differences in the derivative. The cumulative absolute difference of the first derivative shows a greater difference between the two model results highlighting the difference between behaviours.

While the cumulative absolute difference measure cannot give insights into the model structure, it is useful to screen input assumptions that impact model <u> behaviour </u>.

Unlike the extreme test, this analysis focuses on determining which input assumption impacts the model behaviour.

```{r example, echo=F, message=F, error=F, warning=F, fig.height=1*2*4.5, fig.width=1.2*2*4.5, fig.cap="Example plot for model behaviour"}
data.frame(x=seq(0,20, 0.1)) %>%
  mutate(`Base model`=(1/(1+exp(-(1/10)*(x-15))))) %>%
  mutate(`Similar behaviour`=(1/(1+exp(-(1/10)*(x-15))))*(1+(0.01*x))) %>%
  mutate(`Different behaviour`=(1/(1+exp(-(1/10)*(x-15))))+0.05*sin(1*x)) %>%
  gather(., type, y, `Base model`:`Different behaviour`) %>%
  mutate(type=factor(case_when(type=="Base model"~1,
                               type=="Similar behaviour"~2,
                               type=="Different behaviour"~3),
                     levels=c(1,2,3),
                     labels=c("Base model", "Model 1 (Similar behaviour)",
                              "Model 2 (Different behaviour)"))) %>% 
  ggplot()+
  geom_line(aes(x=x, y=y, color=type, linetype=type))+
  scale_y_continuous(limits = c(0,1), labels = scales::percent)+
  ylab("Outcome")+xlab("Modelled years")+
  guides(colour = guide_legend("Legend", ncol = 1),
         linetype = guide_legend("Legend", ncol = 1))+
  scale_linetype_manual(values=c(2,1,1))+
  scale_color_manual(values=c("black", "red", "blue"))+
  theme_bw()+theme(legend.position = "bottom")+
  
  data.frame(x=seq(0,20, 0.1)) %>% 
  mutate(`Base model`=(1/(1+exp(-(1/10)*(x-15))))) %>% 
  mutate(`Similar behaviour`=(1/(1+exp(-(1/10)*(x-15))))*(1+(0.01*x))) %>% 
  mutate(`Different behaviour`=(1/(1+exp(-(1/10)*(x-15))))+0.05*sin(1*x)) %>%
  mutate(delta.x=x-lag(x), delta.y1=`Base model`-lag(`Base model`),
         delta.y2=`Similar behaviour`-lag(`Similar behaviour`),delta.y3=`Different behaviour`-lag(`Different behaviour`)) %>% 
  mutate(`Derivative Base model`=delta.y1/delta.x,
         `Derivative Similar behaviour`=delta.y2/delta.x, 
         `Derivative Different behaviour`=delta.y3/delta.x) %>% 
  select(x, `Derivative Base model`:`Derivative Different behaviour`) %>% 
  gather(., type, y, `Derivative Base model`:`Derivative Different behaviour`) %>% 
  mutate(type=factor(case_when(type=="Derivative Base model"~1,
                               type=="Derivative Similar behaviour"~2,
                               type=="Derivative Different behaviour"~3),
                     levels=c(1,2,3),
                     labels=c("Derivative Base model", "Derivative model 1 (Similar behaviour)",
                              "Derivative  model 2 (Different behaviour)"))) %>% 
  filter(!is.na(y)) %>% 
  ggplot()+
  geom_line(aes(x=x, y=y, color=type, linetype=type))+
  # scale_y_continuous(limits = c(0,1), labels = scales::percent)+
  ylab("First derivative")+xlab("Modelled years")+
  guides(colour = guide_legend("Legend", ncol = 1),
         linetype = guide_legend("Legend", ncol = 1))+
  scale_linetype_manual(values=c(2,1,1))+
  scale_color_manual(values=c("black", "red", "blue"))+
  theme_bw()+theme(legend.position = "bottom")+
  
  data.frame(x=seq(0,20, 0.1)) %>% 
  mutate(`Base model`=(1/(1+exp(-(1/10)*(x-15))))) %>% 
  mutate(`Similar behaviour`=(1/(1+exp(-(1/10)*(x-15))))*(1+(0.01*x))) %>% 
  mutate(`Different behaviour`=(1/(1+exp(-(1/10)*(x-15))))+0.05*sin(1*x)) %>%
  mutate(`Cummulative difference (Similar-Base)`=`Similar behaviour`-`Base model`,
         `Cummulative difference (Different-Base)`=`Different behaviour`-`Base model`) %>% 
  select(x, `Cummulative difference (Similar-Base)`,  `Cummulative difference (Different-Base)`) %>% 
  gather(., type, y, `Cummulative difference (Similar-Base)`:`Cummulative difference (Different-Base)`) %>% 
  group_by(type) %>% mutate(cum.y=cumsum(abs(y))) %>% 
  mutate(type=factor(case_when(type=="Cummulative difference (Similar-Base)"~1,
                               type=="Cummulative difference (Different-Base)"~2),
                     levels=c(1,2),
                     labels=c("Cummulative difference (Model 1 similar-Base)",
                              "Cummulative difference (Model 2 Different-Base)"))) %>% 
  ggplot()+
  geom_line(aes(x=x, y=cum.y, color=type, linetype=type))+
  geom_hline(aes(yintercept=0), color="black", linetype="dashed")+
  # scale_y_continuous(labels = scales::percent)+
  ylab("Cummulative difference \n in outcome")+xlab("Modelled years")+
  guides(colour = guide_legend("Legend", ncol = 1),
         linetype = guide_legend("Legend", ncol = 1))+
  scale_linetype_manual(values=c(1,1))+
  scale_color_manual(values=c("red", "blue"))+
  theme_bw()+theme(legend.position = "bottom")+
  
  data.frame(x=seq(0,20, 0.1)) %>% 
  mutate(`Base model`=(1/(1+exp(-(1/10)*(x-15))))) %>% 
  mutate(`Similar behaviour`=(1/(1+exp(-(1/10)*(x-15))))*(1+(0.01*x))) %>% 
  mutate(`Different behaviour`=(1/(1+exp(-(1/10)*(x-15))))+0.05*sin(1*x)) %>%
  mutate(delta.x=x-lag(x), delta.y1=`Base model`-lag(`Base model`),
         delta.y2=`Similar behaviour`-lag(`Similar behaviour`),delta.y3=`Different behaviour`-lag(`Different behaviour`)) %>% 
  mutate(`Derivative Base model`=delta.y1/delta.x,
         `Derivative Similar behaviour`=delta.y2/delta.x, 
         `Derivative Different behaviour`=delta.y3/delta.x) %>% 
  mutate(`Cummulative difference (Similar-Base)`=`Derivative Similar behaviour`-`Derivative Base model`,
         `Cummulative difference (Different-Base)`=`Derivative Different behaviour`-`Derivative Base model`) %>% 
  select(x, `Cummulative difference (Similar-Base)`,  `Cummulative difference (Different-Base)`) %>% 
  gather(., type, y, `Cummulative difference (Similar-Base)`:`Cummulative difference (Different-Base)`) %>% 
  filter(!is.na(y)) %>% 
  group_by(type) %>% mutate(cum.y=cumsum(abs(y))) %>% 
  mutate(type=factor(case_when(type=="Cummulative difference (Similar-Base)"~1,
                               type=="Cummulative difference (Different-Base)"~2),
                     levels=c(1,2),
                     labels=c("Cummulative difference derivative (Model 1 similar-Base)",
                              "Cummulative difference derivative (Model 2 Different-Base)"))) %>% 
  ggplot()+
  geom_line(aes(x=x, y=cum.y, color=type, linetype=type))+
  geom_hline(aes(yintercept=0), color="black", linetype="dashed")+
  # scale_y_continuous(limits = c(0,1), labels = scales::percent)+
  ylab("Cummulative difference \n in First derivative")+xlab("Modelled years")+
  guides(colour = guide_legend("Legend", ncol = 1),
         linetype = guide_legend("Legend", ncol = 1))+
  scale_linetype_manual(values=c(1,1))+
  scale_color_manual(values=c("red", "blue"))+
  theme_bw()+theme(legend.position = "bottom")+
  
  plot_layout(ncol=2, nrow = 2)+
  plot_annotation(tag_levels = 'A')
```


## How to interpret the results
Each input assumption is sequentially sampled 20 times between +/- 20% of the initial assumed input value. The cumulative difference of the first derivative is used to assess how each variable sample impacts model behaviour and the average cumulative difference between the 20 samples are summarised in the result plots.

The figure below steps through how the summary plots are calculated. The summary plot (subplot A) shows the average cumulative difference between the 20 samples of the metabolic equivalence of task (MET) for vigorous physical activity. This summary plot is presented for all tested variables.

The outcome, prevalence of obesity (subplot B), is plotted for each tested assumption of vigorous MET value across each age group. The subsequent derivative (subplot C) and cumulative difference in the derivative are also plotted (subplot D), with the average incremental difference plotted in red. This is the summary value presented in the summary plots.

A high average cumulative difference in the first derivative suggests a variable with a larger impact on model behaviour.

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.2,fig.height=1*10*2.2}
p.tmp1<-lsa.bmi.df.time.series.diff.derv.summary %>%
filter(focus.title=="VIGOROUS PA METs" ) %>%
  # filter(gender.input=='Male' & age.groups.input=="Age 6 8" & bmi.input=="Overweight") %>%
  filter(gender.output=='Male') %>%
  filter(age.groups.output!="Age 45 49") %>%
  # filter(as.numeric(age.groups.input)<=6) %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output, alpha=bmi.output), size=1, show.legend = F)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output, alpha=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  # facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  # scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
  #                  labels=c("3-5", "18-19", "40-44"))+
  scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                            "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                   labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  scale_alpha_manual(values=c(0.3,0.3,1), )+
    ylab("Mean Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"), alpha = "none")+
  ggtitle("Summary plot: Vigour physical activity METs",subtitle = "Male outcomes")

# p.tmp2<-lsa.bmi.df.time.series.diff.derv %>% 
#   rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input",
#          "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
#   filter(focus.title=="VIGOROUS PA METs" ) %>%
#   # filter(`Gender input`=='Male') %>%
#   filter(`Gender outcome`=='Male') %>%
#   filter(`BMI outcome`=="With obesity") %>%
#   # filter(`BMI input`=="Overweight" ) %>%
#   # filter(`Age input`=="Age 6 8") %>%
#   filter(`Age output`!="Age 45 49") %>%
#   ggplot()+
#   geom_smooth(aes(x=input.value, y=`cum_sum_diff.der_value`), se=F, linewidth=0.5, color=hue_pal()(3)[3], span=0.25)+
#   # geom_vline(aes(xintercept=0, color="Initial assumption"), linetype="dashed", alpha=0.3)+
#   facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
#   scale_colour_manual(values = c("black"))+
#   guides(colour = guide_legend(" "))+
#   # scale_y_continuous(labels = scales::percent, breaks = c(seq(0.05,0.6, 0.15)))+
#   # scale_x_continuous(labels = scales::label_number(suffix = "", scale =1))+
#   ylab("Prevalence of obesity (%) at 2057")+
#   xlab("Percentage of initial assumed Body Weight (kg) for overweight males aged 6 to 8")+
#   theme_bw() +theme(legend.position = "bottom")

p.tmp2<-lsa.bmi.df.time.series.diff.derv %>% 
  rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input",
         "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
  filter(focus.title=="VIGOROUS PA METs" ) %>%
  # filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>%
  # filter(`BMI input`=="Overweight" ) %>%
  # filter(`Age input`=="Age 6 8") %>%
  filter(`Age output`!="Age 45 49") %>%  
  rename("Input value"="input.value") %>% 
  ggplot()+
  geom_line(aes(x=year, y=value, group=run, color=`Input value`), alpha=1)+
  geom_line(aes(x=year, y=value.base.model, group=run), linetype="dashed", color="black")+
  facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  theme_bw()+
  ylab("Prevalence of obesity (%)")+
  scale_y_continuous(labels = scales::percent)+
  guides(colour = guide_legend("Input assumptions"))+
  scale_x_continuous(breaks = c(seq(2007, 2057, 25)))+
  theme(legend.position="bottom")+
  ggtitle("Outcome")
  
p.tmp3<-lsa.bmi.df.time.series.diff.derv %>% 
  rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input",
         "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
  filter(focus.title=="VIGOROUS PA METs" ) %>%
  # filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>%
  # filter(`BMI input`=="Overweight" ) %>%
  # filter(`Age input`=="Age 6 8") %>%
  filter(`Age output`!="Age 45 49") %>%  
    rename("Input value"="input.value") %>% 
  ggplot()+
  geom_line(aes(x=year, y=value.der, group=run, color=`Input value`), alpha=1)+
  geom_line(aes(x=year, y=value.der.base.model, group=run), linetype="dashed", color="black")+
  facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  theme_bw()+
  ylab("First derivative of obesity (%)")+
  scale_y_continuous(labels = scales::percent)+
  scale_x_continuous(breaks = c(seq(2007, 2057, 25)))+
  guides(colour = guide_legend("Input assumptions"))+
  theme(legend.position="bottom")+
  ggtitle("First derivative")
  
p.tmp4<-lsa.bmi.df.time.series.diff.derv %>% 
  rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input",
         "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
  filter(focus.title=="VIGOROUS PA METs" ) %>%
  # filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>%
  # filter(`BMI input`=="Overweight" ) %>%
  # filter(`Age input`=="Age 6 8") %>%
  filter(`Age output`!="Age 45 49") %>%  
    rename("Input value"="input.value") %>% 
  ggplot()+
  geom_line(aes(x=year, y=cum_sum_diff.der_value, group=run, color=`Input value`), alpha=1)+
  stat_summary(aes(x=year, y=cum_sum_diff.der_value), color="red", fun.y=mean,geom="line")+
  # geom_line(aes(x=year, y=value.der.base.model, group=run), linetype="dashed", color="black")+
  facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  theme_bw()+
  ylab("Cumulative difference")+
  # scale_y_continuous(labels = scales::percent)+
  scale_x_continuous(breaks = c(seq(2000, 2057, 20)))+
   guides(colour = guide_legend("Input assumptions"))+
  theme(legend.position="bottom")+
  ggtitle("Cumulative difference: First derivative")



layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
CCCCCCC
CCCCCCC
DDDDDDD
DDDDDDD
'
wrap_plots(A = p.tmp1, B = p.tmp2, C=p.tmp3, D=p.tmp4, design = layout)+
  plot_annotation(tag_levels = 'A')+
# plot_annotation(title = 'Explaination of plots',
#                theme = theme(plot.title = element_text(size = 16, face = c("bold")))) &
theme(legend.position = "bottom")


```

# Results

## Overall Ranking of sensitivity
The 649 input assumptions tested can be summarised into 70 variables by taking the mean of cumulative difference in derivatives age-gender-BMI specific inputs, resulting in 70 overarching variables. These are ranked in the following table.

Below is the ranking of aggregate input assumptions, where input assumptions with multiple input subgroups have been averaged. For example, changes in body weight are tested by age-gender-BMI subgroups however, are ranked based on the mean cumulative difference in first derivatives.

The results show that variables that have a global impact, i.e. those that impact all of the modelled population, have the greatest impact on model behaviour.

```{r, echo=F, message=F, error=F, warning=F}
lsa.bmi.df.time.series.diff.derv.summary %>%
  group_by(focus.title) %>% 
  # summarise(mean_cum_sum_diff.der_value=mean(max_cum_sum_diff.der_value)) %>%
  summarise(mean_cum_sum_diff.der_value=mean(mean_cum_sum_diff.der_value)) %>%
  arrange(-mean_cum_sum_diff.der_value) %>% 
  select(focus.title, mean_cum_sum_diff.der_value) %>% 
  rename("Label"="focus.title", "Average cumulative difference in derivatives"="mean_cum_sum_diff.der_value") %>%
  knitr::kable(.) %>% 
  kableExtra::footnote(., "Ranked variables")
  
```

**Examining the most sensitive variable: energy density of sugar**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.2,fig.height=1*10*2.2}
p.tmp1<-lsa.bmi.df.time.series.diff.derv.summary %>%
filter(focus.title=="SUGAR Kj per gram" ) %>%
  # filter(gender.input=='Male' & age.groups.input=="Age 6 8" & bmi.input=="Overweight") %>%
  filter(gender.output=='Male') %>%
  filter(age.groups.output!="Age 45 49") %>%
  # filter(as.numeric(age.groups.input)<=6) %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output, alpha=bmi.output), size=1, show.legend = F)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output, alpha=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  # facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  # scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
  #                  labels=c("3-5", "18-19", "40-44"))+
  scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                            "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                   labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  scale_alpha_manual(values=c(0.3,0.3,1), )+
    ylab("Mean Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"), alpha = "none")+
  ggtitle("Summary plot: Energy density of sugar",subtitle = "Male outcomes")

# p.tmp2<-lsa.bmi.df.time.series.diff.derv %>% 
#   rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input",
#          "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
#   filter(focus.title=="VIGOROUS PA METs" ) %>%
#   # filter(`Gender input`=='Male') %>%
#   filter(`Gender outcome`=='Male') %>%
#   filter(`BMI outcome`=="With obesity") %>%
#   # filter(`BMI input`=="Overweight" ) %>%
#   # filter(`Age input`=="Age 6 8") %>%
#   filter(`Age output`!="Age 45 49") %>%
#   ggplot()+
#   geom_smooth(aes(x=input.value, y=`cum_sum_diff.der_value`), se=F, linewidth=0.5, color=hue_pal()(3)[3], span=0.25)+
#   # geom_vline(aes(xintercept=0, color="Initial assumption"), linetype="dashed", alpha=0.3)+
#   facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
#   scale_colour_manual(values = c("black"))+
#   guides(colour = guide_legend(" "))+
#   # scale_y_continuous(labels = scales::percent, breaks = c(seq(0.05,0.6, 0.15)))+
#   # scale_x_continuous(labels = scales::label_number(suffix = "", scale =1))+
#   ylab("Prevalence of obesity (%) at 2057")+
#   xlab("Percentage of initial assumed Body Weight (kg) for overweight males aged 6 to 8")+
#   theme_bw() +theme(legend.position = "bottom")

p.tmp2<-lsa.bmi.df.time.series.diff.derv %>% 
  rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input",
         "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
filter(focus.title=="SUGAR Kj per gram" ) %>%
  # filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>%
  # filter(`BMI input`=="Overweight" ) %>%
  # filter(`Age input`=="Age 6 8") %>%
  filter(`Age output`!="Age 45 49") %>%  
  ggplot()+
  geom_line(aes(x=year, y=value, group=run, color=input.value), alpha=1)+
  geom_line(aes(x=year, y=value.base.model, group=run), linetype="dashed", color="black")+
  facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  theme_bw()+
  ylab("Prevalence of obesity (%)")+
  scale_y_continuous(labels = scales::percent)+
  scale_x_continuous(breaks = c(seq(2007, 2057, 25)))+
  theme(legend.position="bottom")+
  ggtitle("Outcome")
  
p.tmp3<-lsa.bmi.df.time.series.diff.derv %>% 
  rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input",
         "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
filter(focus.title=="SUGAR Kj per gram" ) %>%
  # filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>%
  # filter(`BMI input`=="Overweight" ) %>%
  # filter(`Age input`=="Age 6 8") %>%
  filter(`Age output`!="Age 45 49") %>%  
  ggplot()+
  geom_line(aes(x=year, y=value.der, group=run, color=input.value), alpha=1)+
  geom_line(aes(x=year, y=value.der.base.model, group=run), linetype="dashed", color="black")+
  facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  theme_bw()+
  ylab("First derivative of obesity (%)")+
  scale_y_continuous(labels = scales::percent)+
  scale_x_continuous(breaks = c(seq(2007, 2057, 25)))+
  theme(legend.position="bottom")+
  ggtitle("First derivative")
  
p.tmp4<-lsa.bmi.df.time.series.diff.derv %>% 
  rename("Gender input"="gender.input", "BMI outcome"="bmi.output", "BMI input"="bmi.input",
         "Age input"="age.groups.input", "Gender outcome"="gender.output", "Age output"="age.groups.output") %>%
filter(focus.title=="SUGAR Kj per gram" ) %>%
  # filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>%
  # filter(`BMI input`=="Overweight" ) %>%
  # filter(`Age input`=="Age 6 8") %>%
  filter(`Age output`!="Age 45 49") %>%  
  ggplot()+
  geom_line(aes(x=year, y=cum_sum_diff.der_value, group=run, color=input.value), alpha=1)+
  stat_summary(aes(x=year, y=cum_sum_diff.der_value), color="red", fun.y=mean,geom="line")+
  # geom_line(aes(x=year, y=value.der.base.model, group=run), linetype="dashed", color="black")+
  facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  theme_bw()+
  ylab("Cumulative difference")+
  # scale_y_continuous(labels = scales::percent)+
  scale_x_continuous(breaks = c(seq(2000, 2057, 20)))+
  theme(legend.position="bottom")+
  ggtitle("Cumulative difference: First derivative")



layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
CCCCCCC
CCCCCCC
DDDDDDD
DDDDDDD
'
wrap_plots(A = p.tmp1, B = p.tmp2, C=p.tmp3, D=p.tmp4, design = layout)+
# plot_annotation(title = 'Explaination of plots',
#                theme = theme(plot.title = element_text(size = 16, face = c("bold")))) &
theme(legend.position = "bottom")


```


## Body Weight 
**Change in Male Body Weight input assumptions**
```{r Body Weight Male, echo=F, message=F, error=F, warning=F,  fig.width=1.2*6*1.5,fig.height=1*12*1.5}
lsa.bmi.df.time.series.diff.derv.summary %>% 
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(gender.input=='Male') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(gender.input=='Male') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>%   
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Male Body Weight (kg)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

**Change in Female Body Weight input assumptions**
```{r Body Weight Female, echo=F, message=F, error=F, warning=F,  fig.width=1.2*6*1.5,fig.height=1*12*1.5}
lsa.bmi.df.time.series.diff.derv.summary %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(gender.input=='Female') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(gender.input=='Female') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Female Body Weight (kg)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

## Height
**Change in Male height input assumptions**
```{r Height Male, echo=F, message=F, error=F, warning=F,  fig.width=1.2*6*1.5,fig.height=1*12*1.5}
lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(gender.input=='Male') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(gender.input=='Male') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Male height (m)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

**Change in Female height input assumptions**
```{r Height Female, echo=F, message=F, error=F, warning=F,  fig.width=1.2*6*1.5,fig.height=1*12*1.5}
lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(gender.input=='Female') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.001))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(gender.input=='Female') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>%  
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Female height (m)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

## Growth Function kJ/day
```{r Growth Function, echo=F, message=F, error=F, warning=F,  fig.width=1*5*1.7 ,fig.height=1*7*1.7}
# Confirm units
# lsa_bmi_df %>%
#   filter(focus.title=="\"Growth Function kJ/day\"" ) %>%
#   select(input.value, `2057`)

lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="\"Growth Function kJ/day\"" ) %>% 
  mutate(gender.input=factor(case_when(grepl("M]", focus)~0,
                                       grepl("F]", focus)~1),
                             levels=c(0,1),
                             labels=c("Male", "Female"))) %>% 
  filter(gender.input=='Male') %>%
  # filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male growth assumptions")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="\"Growth Function kJ/day\"" ) %>% 
  mutate(gender.input=factor(case_when(grepl("M]", focus)~0,
                                       grepl("F]", focus)~1),
                             levels=c(0,1),
                             labels=c("Male", "Female"))) %>% 
  filter(gender.input=='Female') %>%
  # filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y = element_blank(),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Female growth assumptions")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Growth function (kJ/day)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.7, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

## Macronutrient energy density
```{r macro nutrients Kj per gram, echo=F, message=F, error=F, warning=F,  fig.width=1*4*3.2,fig.height=1*2*3.2}
# Confirm units
# lsa_bmi_df %>%
#   filter(focus.title=="\"NON-SUGAR CARBOHYDRATES Kj per gram\"" ) %>%
#   select(input.value, `2057`)

lsa.bmi.df.time.series.diff.derv.summary %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="\"NON-SUGAR CARBOHYDRATES Kj per gram\"" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy =  0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per Kj increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="FATS Kj per gram" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy =  0.01))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="PROTEIN Kj per gram" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy =  0.01))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="SUGAR Kj per gram" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per Kj increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")+
  
  plot_layout(nrow = 2, ncol=2, guides = "collect")+
  plot_annotation(title = 'Energy density',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

## Thermic effect of food (TEF)
```{r TEF, echo=F, message=F, error=F, warning=F,  fig.width=1*4*3.2,fig.height=1*2*3.2}
# Confirm units
# lsa_bmi_df %>%
#   filter(focus.title=="CARBOHYDRATE TEF" ) %>%
#   select(input.value, `2057`)

lsa.bmi.df.time.series.diff.derv.summary %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="CARBOHYDRATE TEF" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="FATS TEF" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="PROTEIN TEF" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="SUGAR TEF" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")+
  
  plot_layout(nrow = 2, ncol=2, guides = "collect")+
  plot_annotation(title = 'Thermic Effect of Food (TEF)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

## Adult to Adult Social Transmission
```{r Adult to Adult Social Transmission, echo=F, message=F, error=F, warning=F,  fig.width=1*3*2.7,fig.height=1*2.7*2.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Adult to Adult Social Transmission of DIET Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Adult Social Transmission of dietary Behaviors")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Adult to Adult Social Transmission of PAL Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Adult Social Transmission of physical Behaviors")+

  plot_layout(nrow = 2, guides = "collect") +
  plot_annotation(title = 'Adult to Adult Role Modelling',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
  
```

## Adult to Child Social Transmission
```{r Adult to Child Social Transmission, echo=F, message=F, error=F, warning=F, fig.width=1*3*2.7,fig.height=1*2.7*2.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Adult to Child Social Transmission DIET Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Child Social Transmission of dietary Behaviors")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Adult to Child Social Transmission PAL Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Child Social Transmission of physical Behaviors")+

  plot_layout(nrow = 2, guides = "collect") +
  plot_annotation(title = 'Adult to Child Role Modelling',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

## Child to Child Social Transmission
```{r Child to Child Social Transmission, echo=F, message=F, error=F, warning=F, fig.width=1*3*2.7,fig.height=1*2.7*2.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Child to Child Social Transmission of DIET Behavior" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Child to Child Social Transmission of dietary Behaviors")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Child to Child Social Transmission of PAL Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Child to Child Social Transmission of physical Behaviors")+

  plot_layout(nrow = 2, guides = "collect") +
  plot_annotation(title = 'Child to Child Role Modelling',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```


## Infant Reported behaviours
```{r Infant Reported behaviours, echo=F, message=F, error=F, warning=F, fig.width=1*2.2*3,fig.height=1*3.7*3}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="\"Percentage BF >6mths reported\"" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Percentage of mothers breastfeeding to 6 months")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="\"Percentage non-core > 0 reported\"" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Percentage of infants consuming non-core foods")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="\"Percentage TV >1 per day reported\"" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Percentage of infants watching TV more than 1 hr/day")+
  
  plot_layout(nrow = 3, ncol=1, guides = "collect") +
  plot_annotation(title = 'Infant behaviours',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```



## Assumed intergenerational relationships
```{r Intergenerational OR effects, echo=F, message=F, error=F, warning=F, fig.width=1*2*3.5,fig.height=1*5*3.5}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Intercept" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Intercept")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Parents BMI" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 odds ratio (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Impact of parents BMI on infants weight")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Breastfeeding >=6mth" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Impact of breastfeeding on infants weight")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="TV >=1" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in BMI %", "per 0.01 unit (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Impact of TV on infants weight")+
  
    lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Non-core >0" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Impact of non-core foods on infants weight")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") +
  plot_annotation(title = 'Logistic regression odds ratio',subtitle = "Odds of overweight or obesity at 2 years",
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) & 
  theme(legend.position = "bottom")

```

## Mortality ratios
```{r Mortality ratios, echo=F, message=F, error=F, warning=F, fig.width=1*3*2.7,fig.height=1*2*2.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="BMI Hazards Ratios" ) %>%
    rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Hazards Ratios")+
    plot_annotation(title = 'Mortality',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")
  
  

```

## The Metabolic Equivalent of Task (MET)
```{r METs, echo=F, message=F, error=F, warning=F, fig.width=1*4*3.2,fig.height=1*3*3.2}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
 filter(focus.title=="INACTIVE METs") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("METs - Inactivity")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="SCREEN TIME METs") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("METs - Screen time")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="SLEEP METs") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("METs - Sleep")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="LIGHT PA METs") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("METs - Light physical activity")+
  
    lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="MODERATE PA METs") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("METs - Moderate physical activity")+
  
    lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="VIGOROUS PA METs") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("METs - Vigorous physical activity")+
  
  plot_layout(ncol=2, nrow = 3, guides = "collect") +
  plot_annotation(title = 'Metabolic Equivelence of Task (MET)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) & 
  theme(legend.position = "bottom")
```

## Light physical activity
```{r LIGHT PA, echo=F, message=F, error=F, warning=F, fig.width=10, fig.height=10}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily LIGHT PA minutes Reported INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Light physical activity - Intercept")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily LIGHT PA minutes Reported AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Light physical activity - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily light physical activity minutes',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

## Moderate physical activity
```{r MODERATE PA, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily MODERATE PA minutes Reported INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moderate physical activity - Intercept")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily MODERATE PA minutes Reported AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moderate physical activity - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily moderate physical activity minutes',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

## Vigorous physical activity
```{r VIGOROUS PA, echo=F, message=F, error=F, warning=F,  fig.width=1*6*1.7,fig.height=1*6*1.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily VIGOROUS PA minutes Reported INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Vigorous physical activity - Intercept")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily VIGOROUS PA minutes Reported AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Vigorous physical activity - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily vigorous physical activity minutes',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

## Screen time
```{r SCREEN TIME, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily SCREEN TIME minutes Reported INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1), limits = c(0,0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Screen time - Intercept")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
 filter(focus.title=="Daily SCREEN TIME minutes Reported AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1), limits = c(0,0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Screen time - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily screen time minutes',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")
```

## Sleep
```{r SLEEP, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily SLEEP minutes Reported INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sleep - Intercept")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Daily SLEEP minutes Reported AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sleep - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily minutes of sleep',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

## Fruit Reported Intake
```{r Fruit Reported Intake, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Fruit Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Fruit consumption - Intercept")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Fruit Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Fruit consumption - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of fruit',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

## Vegetables Reported Intake
```{r Vegetables Reported Intake, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Vegetables Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Vegetable consumption - Intercept")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Vegetables Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Vegetable consumption - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of vegetables',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

## Grains Reported Intake
```{r Grains Reported Intake, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Grains Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Grain consumption - Intercept")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Grains Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Grain consumption - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of grains',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")
```

## Dairy Reported Intake
```{r Dairy Reported Intake, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Dairy Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dairy consumption - Intercept")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Dairy Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dairy consumption - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of dairy',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

## Meat and Protein Reported
```{r Meat and Protein Reported, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Meat and Protein Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Meat and protein consumption - Intercept")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Meat and Protein Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Meat and protein consumption - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of meat and protein',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")


```

## Discretionary foods Reported
```{r Discretionary foods Reported, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Discretionary foods Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Discretionary consumption - Intercept")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Discretionary foods Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Discretionary consumption - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of discretionary',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

## Fats and Oils Reported
```{r Fats and Oils Reported, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Fats and Oils Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Fats and Oils consumption - Intercept")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Fats and Oils Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Fats and Oils consumption - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of Fats and Oils',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")


```

## Sugar based beverage Reported
```{r Sugar based beverage Reported, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Sugar based beverage Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugar based beverage consumption - Intercept")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Sugar based beverage Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugar based beverage consumption - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of sugar based beverage',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")


```

## Water Reported
```{r Water Reported, echo=F, message=F, error=F, warning=F, fig.width=1*6*1.7,fig.height=1*6*1.7}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Water Reported Intake INTERCEPT" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Water consumption - Intercept")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "Gender input"="gender.input",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus.title=="Water Reported Intake AGE SLOPE" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # facet_grid(col=vars(gender.output, bmi.input), rows = vars(`Gender input`), scale="free")+
  facet_grid2(col=vars(`Gender outcome`, `BMI input`), rows = vars(`Gender input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Water consumption - Age change")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Daily consumption of water',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

## Initial fat-mass (%)
**Change in Male fat-mass % assumptions**
```{r Initial FM Male, echo=F, message=F, error=F, warning=F,  fig.width=1*6.2*1.5,fig.height=1*12*1.5}
lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(gender.input=='Male') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 1))+
      scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(gender.input=='Male') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
    scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Male initial fat-mass %',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

**Change in Female fat-mass % assumptions**
```{r Initial FM Female, echo=F, message=F, error=F, warning=F,  fig.width=1*6.2*1.5,fig.height=1*12*1.5}
lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(gender.input=='Female') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 1))+
      scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(gender.input=='Female') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.01))+
    scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Change in BMI", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Female initial fat-mass %',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```



##  Proportion of nutrients within food group Inputs     
**Grains**
```{r Prop of nutrients within food group Grains, echo=F, message=F, error=F, warning=F,  fig.width=1*2*3.2,fig.height=1*5*3.2}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Grains]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Grains]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Grains]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Grains]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Grains]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within grains',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")


```

**Vegetables**
```{r Prop of nutrients within food group vegetable, echo=F, message=F, error=F, warning=F,  fig.width=1*2*3.2,fig.height=1*5*3.2}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Vegetables]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Vegetables]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Vegetables]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Vegetables]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Vegetables]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within vegetables',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Fruit**
```{r Prop of nutrients within food group Fruit, echo=F, message=F, error=F, warning=F,  fig.width=1*2*3.2,fig.height=1*5*3.2}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Fruit]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Fruit]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Fruit]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Fruit]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Fruit]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within fruit',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Dairy**
```{r Prop of nutrients within food group Dairy, echo=F, message=F, error=F, warning=F, fig.width=1*2*3.2,fig.height=1*5*3.2}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Dairy]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Dairy]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Dairy]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Dairy]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Dairy]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within dairy',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")


```

**Meat and Protein**
```{r Prop of nutrients within food group Meat, echo=F, message=F, error=F, warning=F, fig.width=1*2*3.2,fig.height=1*5*3.2}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Meat]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Meat]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Meat]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Meat]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Meat]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within meat and protein',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")

```

**Fats**
```{r Prop of nutrients within food group Fats, echo=F, message=F, error=F, warning=F, fig.width=1*2*3.2,fig.height=1*5*3.2}
# lsa.bmi.df.time.series.diff.derv.summary %>%
#   rename("Gender outcome"="gender.output",
#          "BMI input"="bmi.input",
#          "Age input"="age.groups.input") %>% 
#   filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Fats]" ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
#   facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("BMI outcomes"))+
#   ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Fats]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Fats]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Fats]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Fats]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture")+
  
  plot_layout(nrow = 4, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within fats and oil',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")


```

**Discretionary foods**
```{r Prop of nutrients within food group Discretionary_foods, echo=F, message=F, error=F, warning=F, fig.width=1*2*3.2,fig.height=1*5*3.2}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Discretionary_foods]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Discretionary_foods]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Discretionary_foods]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Discretionary_foods]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Discretionary_foods]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within discretionary food',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")


```

**Sugar-sweetened beverages**
```{r Prop of nutrients within food group Sugar_Sweetened_beverage, echo=F, message=F, error=F, warning=F, fig.width=1*2*3.2,fig.height=1*5*3.2}
# lsa.bmi.df.time.series.diff.derv.summary %>%
#   rename("Gender outcome"="gender.output",
#          "BMI input"="bmi.input",
#          "Age input"="age.groups.input") %>%
#   filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Sugar_Sweetened_beverage]" ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
#   facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("BMI outcomes"))+
#   ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
#   
#   lsa.bmi.df.time.series.diff.derv.summary %>%
#   rename("Gender outcome"="gender.output",
#          "BMI input"="bmi.input",
#          "Age input"="age.groups.input") %>% 
#   filter(focus=="Proportion of nutrients within food group Inputs[Fats, Sugar_Sweetened_beverage]" ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
#   facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("BMI outcomes"))+
#   ggtitle("Dietary fats", subtitle = "Units: per percentage point")+
#   
#   lsa.bmi.df.time.series.diff.derv.summary %>%
#   rename("Gender outcome"="gender.output",
#          "BMI input"="bmi.input",
#          "Age input"="age.groups.input") %>% 
#    filter(focus=="Proportion of nutrients within food group Inputs[Protein, Sugar_Sweetened_beverage]" ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
#   facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in BMI %", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("BMI outcomes"))+
#   ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Sugar_Sweetened_beverage]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Sugar_Sweetened_beverage]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture")+
  
  plot_layout(nrow = 2, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within sugar-sweetened beverages',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")


```

**Miscellaneous (Other)**
```{r Prop of nutrients within food group Other, echo=F, message=F, error=F, warning=F, fig.width=1*2*3.2,fig.height=1*5*3.2}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, Other]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, Other]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, Other]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, Other]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, Other]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within miscellaneous (Other)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")


```

**Non-sugar-sweetened beverages**
```{r Prop of nutrients within food group NonAlcoholic_beverage, echo=F, message=F, error=F, warning=F, fig.width=1*2*3.2,fig.height=1*5*3.2}
lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%
  filter(focus=="Proportion of nutrients within food group Inputs[Carbohydrates, NonAlcoholic_beverage]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Fats, NonAlcoholic_beverage]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
   filter(focus=="Proportion of nutrients within food group Inputs[Protein, NonAlcoholic_beverage]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Sugars, NonAlcoholic_beverage]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  filter(focus=="Proportion of nutrients within food group Inputs[Moisture, NonAlcoholic_beverage]" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "", scale =1, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Moisture")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = 'Percentage of macro-nutrients within beverage (Non-SSB)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")

```

## Initial BMI Prevalence Inputs
**Change in Male Initial BMI Prevalence**
```{r Body Male Initial BMI Prevalence, echo=F, message=F, error=F, warning=F,  fig.width=1.1*6*1.5,fig.height=1*12*1.5}
lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(gender.input=='Male') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(gender.input=='Male') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>%   
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Male Initial BMI Prevalence',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

**Change in Female Initial BMI Prevalence**
```{r Body Female Initial BMI Prevalence, echo=F, message=F, error=F, warning=F,  fig.width=1.1*6*1.5,fig.height=1*12*1.5}
lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(gender.input=='Female') %>%
  filter(gender.output=='Male') %>%
  # filter(as.numeric(age.groups.input)<=6) %>% 
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  # geom_smooth(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output), se=F, linewidth=0.5)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Male outcomes")+
  
  lsa.bmi.df.time.series.diff.derv.summary %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(gender.input=='Female') %>%
  filter(gender.output=='Female') %>%
  # filter(as.numeric(age.groups.input)<=6) %>%   
  rename("Gender outcome"="gender.output",
         "BMI input"="bmi.input",
         "Age input"="age.groups.input") %>%   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean_cum_sum_diff.der_value, color=bmi.output), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean_cum_sum_diff.der_value, color=bmi.output))+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = ""))+
  xlab("Age outcomes")+
    ylab("Max Cummulative difference \n of the first derivative")+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.title.y = element_blank(),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Females outcomes")+

plot_layout(nrow = 1, ncol=2, guides = "collect") + 
  plot_annotation(title = 'Female Initial BMI Prevalence',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
```

