---
title: "7 Sensitivity analysis - Compare Derivative plots"
author: "Simon Chiu"
date: "`r Sys.Date()`"
output:
  rmdformats::robobook:
    highlight: kate
  html_document:
    df_print: paged
  pdf_document: default
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}
# knitr::opts_chunk$set(echo = TRUE)

library(progress)
library(tidyverse)
library(openxlsx)
library(ggplot2)
library(patchwork)
library(ggh4x)
library(ggpubr)
library(ggbrace)
library(scales)

rm(list=ls())
gc()


derivative.lsa<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_2023-07-25.RDS")

derivative.lsa.epoch<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_epoch_2023-08-06.RDS")

derivative.lsa.epoch<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_epoch_2023-08-06.RDS")
derivative.lsa.cci<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_cci_2023-08-06.RDS")
derivative.lsa.si<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_si_2023-08-06.RDS")
derivative.lsa.svi<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_svi_2023-08-06.RDS")
derivative.lsa.ssb<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/derivative_lsa_ssb_2023-08-06.RDS")

lsa_bmi_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/lsa_bmi_df_2023-07-18.RDS")

plot.df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/comparison_data_2023-07-28.RDS") %>%
rename("BMI output"="bmi.output")

focus_df<-readRDS("/media/simon/ExtSSD/Documents/PhD/4 SD Model/7 Sensitivity/Data/R/focus_df_2023-07-18.RDS")

list.of.focus.variables<-focus_df %>% 
arrange(focus.title, gender.input, bmi.input, age.groups.input) %>% 
select(focus.title) %>% 
group_by(focus.title) %>% filter(row_number()==1)%>% data.frame()

list.of.focus.variables.levels<-focus_df %>% 
arrange(focus.title, gender.input, bmi.input, age.groups.input) %>% 
select(focus) %>% 
group_by(focus) %>% filter(row_number()==1)%>% data.frame()

list.of.focus.variables.levels.plot.search<-focus_df %>% 
  # filter(is.na(age.groups.input) |
  #        age.groups.input=="Age 2" |
  #        grepl("Age 9 11", age.groups.input) | 
  #        grepl("Age 18 19", age.groups.input)) %>% 
# arrange(focus.title, gender.input, bmi.input, age.groups.input) %>% 
arrange(focus.title, age.groups.input) %>% 
# select(focus, focus.title) %>% 
group_by(focus) %>% filter(row_number()==1)%>% data.frame()



derivative.lsa.combined<-
  derivative.lsa.epoch %>% mutate(scenario="1 EPOCH") %>% 
  add_case(derivative.lsa.cci %>% mutate(scenario="2 CCI")) %>%
  add_case(derivative.lsa.si %>% mutate(scenario="3 SI")) %>%
  add_case(derivative.lsa.svi %>% mutate(scenario="4 SVI")) %>%
  add_case(derivative.lsa.ssb %>% mutate(scenario="5 SSB")) %>%
  mutate(scenario=factor(case_when(scenario == "1 EPOCH"~1,
                                 scenario == "2 CCI"~2,
                                 scenario == "3 SI"~3,
                                 scenario == "4 SVI"~4,
                                 scenario == "5 SSB"~5,
                                 scenario == "6 EPOCH CCI"~6,
                                 scenario == "7 SI SVI"~7,
                                 scenario == "8 EPOCH CCI SI SVI"~8,
                                 scenario == "9 EPOCH CCI SI SVI SSB"~9),
                       levels=c(1:9),
                       labels = c("EPOCH", "CCI", "SI", "SVI", "SSB", "EPOCH+CCI",
                                  "SI+SVI",  "EPOCH+CCI+SI+SVI", "EPOCH+CCI+SI+SVI+SSB"))) %>% 
  rename("Gender input"="gender.input", "Gender outcome"="gender.output", 
         "Age input"="age.groups.input", "BMI outcome"="bmi.output",
         "BMI input"="bmi.input")

```


# Body Weight 
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1*5*2.2,fig.height=1*4*2.2}
p.tmp1<-derivative.lsa.combined %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  filter(`BMI input`=="Overweight" & `Age input`=="Age 3 5") %>% 
    filter(age.groups.output!="Age 45 49") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1, show.legend = F)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario), show.legend = F)+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  # scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
  #                  labels=c("3-5", "18-19", "40-44"))+
  scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                            "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                   labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age")+
  ylab(bquote(atop("Average change in the reduction in", " obesity from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in obesity from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text.x = element_text(size = 6),
                   # strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7),
                   axis.title.y = element_text(size=8))+
  # guides(colour = guide_legend())+
  ggtitle("Outcome: Males with obesity")

p.tmp2<-plot.df %>% 
  rename("Gender input"="gender.input", "BMI outcome"="BMI output", "BMI input"="bmi.input", "Age input"="age.groups.input") %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  filter(`BMI input`=="Overweight" ) %>% 
  filter(`Age input`=="Age 3 5") %>%
  filter(`Age output`!="Age 45 49") %>% 
  ggplot()+
  # geom_point(aes(x=input.value, y=diff, color=scenario))+
  geom_smooth(aes(x=input.value, y=diff, color=scenario), se=F, linewidth=0.5)+
  # geom_vline(aes(xintercept=initial.input, color="Initial assumption", linetype="Initial assumption", alpha="Initial assumption"))+
  # geom_vline(aes(xintercept=33, color="Initial assumption", linetype="Initial assumption", alpha="Initial assumption"))+
  facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  # scale_linetype_manual(breaks = c("Initial assumption", "EPOCH", "CCI", "SI", "SVI", "SSB") ,
  #                       values = c(2,1,1,1,1,1))+
  # scale_alpha_manual(breaks = c("Initial assumption", "EPOCH", "CCI", "SI", "SVI", "SSB") ,
  #                       values = c(0.3,1,1,1,1,1))+
  # scale_colour_manual(breaks = c("Initial assumption", "EPOCH", "CCI", "SI", "SVI", "SSB") ,values = c("black", hue_pal()(5) ))+
  # geom_line(aes(x=input.value, y=diff, color=scenario))+
  # geom_line(aes(x=input.value, y=base.model.value), linetype="dashed")+
  facet_wrap(vars(`Age output`), scales="free", ncol = 4, nrow=3)+
  guides(colour = guide_legend("Scenario"),
         linetype = guide_legend("Scenario"),
         alpha = guide_legend("Scenario"))+
  scale_y_continuous(labels = scales::percent)+
  ylab("Change in the prevalence of obesity (%)")+xlab("Assumed Body Weight (kg) for overweight males aged 3 to 5")+
  theme_bw() +theme(legend.position = "bottom")

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)+
  plot_annotation(title = 'Explaination of plots',
                   theme = theme(plot.title = element_text(size = 16, face = c("bold")))) & 
  theme(legend.position = "bottom")

```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1*5*2.2,fig.height=1*4*2.2}
p.tmp1<-derivative.lsa.combined %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  filter(`BMI input`=="With obesity" & `Age input`=="Age 12 14") %>% 
    filter(age.groups.output!="Age 45 49") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1, show.legend = F)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario), show.legend = F)+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  # scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
  #                  labels=c("3-5", "18-19", "40-44"))+
  scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                            "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                   labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age")+
  ylab(bquote(atop("Average change in the reduction in", " obesity from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text.x = element_text(size = 6),
                   # strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7),
                   axis.title.y = element_text(size=8))+
  # guides(colour = guide_legend())+
  ggtitle("Outcome: Males with obesity")

p.tmp2<-plot.df %>% 
  rename("Gender input"="gender.input", "BMI outcome"="BMI output", "BMI input"="bmi.input", "Age input"="age.groups.input") %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  filter(`BMI input`=="With obesity" & `Age input`=="Age 12 14") %>% 
  filter(`Age output`!="Age 45 49") %>% 
  ggplot()+
  # geom_point(aes(x=input.value, y=diff, color=scenario))+
  geom_smooth(aes(x=input.value, y=diff, color=scenario), se=F, linewidth=0.5)+
  # geom_line(aes(x=input.value, y=diff, color=scenario))+
  # geom_line(aes(x=input.value, y=base.model.value), linetype="dashed")+
  facet_wrap(vars(`Age output`), scales="free", ncol = 4, nrow=3)+
   guides(colour = guide_legend("Scenario"))+
  scale_y_continuous(labels = scales::percent)+
  ylab("Change in the prevalence of obesity (%)")+xlab("Assumed Body Weight (kg) for overweight males aged 3 to 5")+
  theme_bw() +theme(legend.position = "bottom")

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)+
  plot_annotation(title = 'Explaination of plots',
                   theme = theme(plot.title = element_text(size = 16, face = c("bold")))) & 
  theme(legend.position = "bottom")

```


**Change in male body weight input assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>% 
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males", subtitle = "Units: per Kg")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males with obesity", subtitle = "Units: per Kg")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male body weight (kg)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females", subtitle = "Units: per Kg")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity", subtitle = "Units: per Kg")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male body weight (kg)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Change in female body weight input assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males with obesity", subtitle = "Units: per Kg")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Female body weight (kg)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females", subtitle = "Units: per Kg")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="\"Body Weight (kg)\"" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity", subtitle = "Units: per Kg")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Female body weight (kg)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```


# Height
**Change in male height input assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males", subtitle = "Units: per m")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males with obesity", subtitle = "Units: per m")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male height (m)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females", subtitle = "Units: per m")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity", subtitle = "Units: per m")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male height (m)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```
**Change in female height input assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males", subtitle = "Units: per m")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males with obesity", subtitle = "Units: per m")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Female height (m)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females", subtitle = "Units: per m")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="\"Reference height (m)\"" ) %>% 
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per m increase in height  (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity", subtitle = "Units: per m")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Female height (m)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

# Growth Function kJ/day
**Males**
```{r , echo=F, message=F, error=F, warning=F, fig.width=1.6*5*1.2,fig.height=1*8*1.2}
# plot.df %>%
#     filter(focus.title=="\"Growth Function kJ/day\"") %>% 
#   select(input.value, int.value)


derivative.lsa.combined %>%
    filter(focus.title=="\"Growth Function kJ/day\"") %>% 
   mutate(`Gender input`=factor(case_when(grepl(", M]", focus)~1,
                                       grepl(", F]", focus)~2),
                             levels=c(1,2),
                             labels=c("Male","Female"))) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males", subtitle = "Units: per kJ")+
  
  derivative.lsa.combined %>%
    filter(focus.title=="\"Growth Function kJ/day\"") %>% 
   mutate(`Gender input`=factor(case_when(grepl(", M]", focus)~1,
                                       grepl(", F]", focus)~2),
                             levels=c(1,2),
                             labels=c("Male","Female"))) %>% 
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                                     axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Female", subtitle = "Units: per kJ")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male Growth Function (kJ/day)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Females**
```{r , echo=F, message=F, error=F, warning=F, fig.width=1.6*5*1.2,fig.height=1*8*1.2}
derivative.lsa.combined %>%
    filter(focus.title=="\"Growth Function kJ/day\"") %>% 
   mutate(`Gender input`=factor(case_when(grepl(", M]", focus)~1,
                                       grepl(", F]", focus)~2),
                             levels=c(1,2),
                             labels=c("Male","Female"))) %>% 
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text.x = element_text(size = 6),
                   # strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males", subtitle = "Units: per kJ")+
  
  derivative.lsa.combined %>%
    filter(focus.title=="\"Growth Function kJ/day\"") %>% 
   mutate(`Gender input`=factor(case_when(grepl(", M]", focus)~1,
                                       grepl(", F]", focus)~2),
                             levels=c(1,2),
                             labels=c("Male","Female"))) %>% 
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI outcome`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                                     axis.title.y =element_blank(),
                   # strip.text.x = element_text(size = 6),
                   # strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Female", subtitle = "Units: per kJ")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Female Growth Function (kJ/day)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

# Macro nutrients Kj per gram
```{r, echo=F, message=F, error=F, warning=F, fig.width=1.6*4*2,fig.height=1*6*2}

left.margin=50

p.tmp1<-derivative.lsa.combined %>%
  filter(focus.title=="\"NON-SUGAR CARBOHYDRATES Kj per gram\"" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per Kj increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates", subtitle = "Units: per kJ/g")
  
p.tmp2<-derivative.lsa.combined %>%
  filter(focus.title=="FATS Kj per gram" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
    scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per Kj increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats", subtitle = "Units: per kJ/g")
  
p.tmp3<-derivative.lsa.combined %>%
  filter(focus.title=="PROTEIN Kj per gram" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per Kj increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein", subtitle = "Units: per kJ/g")
  
p.tmp4<-derivative.lsa.combined %>%
  filter(focus.title=="SUGAR Kj per gram" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
    ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per Kj increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars", subtitle = "Units: per kJ/g")

tmp.y.lab<-p.tmp1$labels$y
p.tmp1$labels$y<-"";p.tmp2$labels$y<-"";p.tmp3$labels$y<-"";p.tmp4$labels$y<-""

p.tmp1+p.tmp2+p.tmp3+p.tmp4+
  plot_layout(nrow = 4, ncol=1, guides = "collect")+
  plot_annotation(title = 'Energy density (kJ/gram)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom"); grid::grid.draw(grid::textGrob(tmp.y.lab, x = 0.03, rot = 90))

```


**Example of interpretation**
```{r macro nutrients Kj per gram example, echo=F, message=F, error=F, warning=F, fig.width=3*2, fig.height=2*2}
# lsa_bmi_df %>%
#   filter(focus.title=="FATS Kj per gram" ) %>%
#   filter(age.groups.output=="Age 18 19" & bmi.output=="Overweight" & gender.output=="Male") %>%
#   mutate(`2057`=`2057`*100) %>%
#   select(input.value,`2057`) %>%
#   ggplot()+
#   geom_hline(aes(yintercept=det_bmi_df %>%
#                    filter(scenario=="Base model" & age.groups.output=="Age 18 19" & bmi.output=="Overweight" & gender.output=="Male") %>%
#                    mutate(`2057`=`2057`*100) %>% select(`2057`) %>% pull), linetype="dashed")+
#   geom_vline(aes(xintercept=sensitivity_ran_variables %>%
#                    filter(label=="FATS Kj per gram" ) %>%
#                    select(values) %>% pull), linetype="dashed")+
#   geom_point(aes(x=input.value, y=`2057`))+
#   geom_smooth(aes(x=input.value, y=`2057`), se=F)+
#   xlab("FATS Kj per gram")+ylab("Prevalence @ 2057 (%)")+
#   ggtitle("Males Age 18 19 Overweight")+theme_bw()+
#   scale_x_continuous(breaks=c(35,37.7, 38.7, 40))+
#   scale_y_continuous(breaks=c(10,20,23.65,30,40,50))
```

# Thermic effect of food (TEF)
```{r, echo=F, message=F, error=F, warning=F, fig.width=1.6*4*2,fig.height=1*6*2}

left.margin=50

p.tmp1<-derivative.lsa.combined %>%
  filter(focus.title=="CARBOHYDRATE TEF" ) %>% 
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 TEF increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Carbohydrates", subtitle = "Units: per 0.01 TEF (each additional percentage used for digestion)")
  
p.tmp2<-derivative.lsa.combined %>%
  filter(focus.title=="FATS TEF" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 TEF increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Dietary fats", subtitle = "Units: per 0.01 TEF (each additional percentage used for digestion)")
  
p.tmp3<-derivative.lsa.combined %>%
  filter(focus.title=="PROTEIN TEF" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 TEF increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Protein", subtitle = "Units: per 0.01 TEF (each additional percentage used for digestion)")
  


p.tmp4<-derivative.lsa.combined %>%
  filter(focus.title=="SUGAR TEF" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
    ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 TEF increase (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   # axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8),
                   # unit(c(top, right, bottom, left), units)
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Sugars", subtitle = "Units: per 0.01 TEF (each additional percentage used for digestion)")

tmp.y.lab<-p.tmp1$labels$y
p.tmp1$labels$y<-"";p.tmp2$labels$y<-"";p.tmp3$labels$y<-"";p.tmp4$labels$y<-""

p.tmp1+p.tmp2+p.tmp3+p.tmp4+
  plot_layout(nrow = 4, ncol=1, guides = "collect")+
  plot_annotation(title = 'Thermic effect of food (TEF)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom"); grid::grid.draw(grid::textGrob(tmp.y.lab, x = 0.03, rot = 90))

```



**Example of interpretation**
```{r TEF example, echo=F, message=F, error=F, warning=F,  fig.width=1*5*2.2,fig.height=1*4*2.2}
p.tmp1<-derivative.lsa.combined %>%
  filter(focus.title=="PROTEIN TEF" ) %>%
  # filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  # filter(`BMI input`=="Overweight" & `Age input`=="Age 3 5") %>% 
  filter(age.groups.output!="Age 45 49") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=output.range, color=scenario), size=1, show.legend = F)+
  geom_line(aes(x=as.numeric(age.groups.output), y=output.range, color=scenario), show.legend = F)+
  facet_grid2(col=vars(`Gender outcome`), rows=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  # scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
  #                  labels=c("3-5", "18-19", "40-44"))+
  scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                            "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                   labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
  xlab("Age")+
  ylab(bquote(atop("Average change in the reduction in", " obesity from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text.x = element_text(size = 6),
                   # strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7),
                   axis.title.y = element_text(size=8))+
  # guides(colour = guide_legend())+
  ggtitle("Outcome: Males with obesity", subtitle = "Units: per 0.01 Protein TEF (each additional percentage used for digestion)")

p.tmp2<-plot.df %>% 
  rename("Gender input"="gender.input", "BMI outcome"="BMI output", "BMI input"="bmi.input", "Age input"="age.groups.input") %>%
  filter(focus.title=="PROTEIN TEF" ) %>%
  # filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  # filter(`BMI input`=="Overweight" ) %>% 
  # filter(`Age input`=="Age 3 5") %>%
  filter(`Age output`!="Age 45 49") %>% 
  ggplot()+
  # geom_point(aes(x=input.value, y=diff, color=scenario))+
  geom_smooth(aes(x=input.value, y=diff, color=scenario), se=F, linewidth=0.5)+
  # geom_vline(aes(xintercept=initial.input, color="Initial assumption", linetype="Initial assumption", alpha="Initial assumption"))+
  # geom_vline(aes(xintercept=33, color="Initial assumption", linetype="Initial assumption", alpha="Initial assumption"))+
  facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  # scale_linetype_manual(breaks = c("Initial assumption", "EPOCH", "CCI", "SI", "SVI", "SSB") ,
  #                       values = c(2,1,1,1,1,1))+
  # scale_alpha_manual(breaks = c("Initial assumption", "EPOCH", "CCI", "SI", "SVI", "SSB") ,
  #                       values = c(0.3,1,1,1,1,1))+
  # scale_colour_manual(breaks = c("Initial assumption", "EPOCH", "CCI", "SI", "SVI", "SSB") ,values = c("black", hue_pal()(5) ))+
  # geom_line(aes(x=input.value, y=diff, color=scenario))+
  # geom_line(aes(x=input.value, y=base.model.value), linetype="dashed")+
  facet_wrap(vars(`Age output`), scales="free", ncol = 4, nrow=3)+
  guides(colour = guide_legend("Scenario"),
         linetype = guide_legend("Scenario"),
         alpha = guide_legend("Scenario"))+
  scale_y_continuous(labels = scales::percent)+
  ylab("Change in the prevalence of obesity (%)")+xlab("Assumed thermic effect of proteint")+
  theme_bw() +theme(legend.position = "bottom")

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)+
  plot_annotation(title = 'Explaination plots',
                   theme = theme(plot.title = element_text(size = 16, face = c("bold")))) & 
  theme(legend.position = "bottom")

```



# Adult to Adult Social Transmission
```{r Adult to Adult Social Transmission, echo=F, message=F, error=F, warning=F,  fig.width=1.6*2*3,fig.height=1*4*3}
# Confirm units
# lsa_bmi_df %>%
#     filter(focus.title=="Adult to Adult Social Transmission of DIET Behaviors" ) %>%
#   select(input.value, `2057`)
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="Adult to Adult Social Transmission of DIET Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Adult Social Transmission of dietary Behaviors", subtitle = "Units: per 1% change in correlation betwee age groups")+
  
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="Adult to Adult Social Transmission of PAL Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Adult Social Transmission of physical Behaviors", subtitle = "Units: per 1% change in correlation betwee age groups")+

  plot_layout(nrow = 2, guides = "collect") +
  plot_annotation(title = 'Adult to Adult Role Modelling',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
  
```



# Adult to Child Social Transmission
Similar to "Adult to Adult" role-modelling, there is little impact in BMI outcome when Adult to Child role-modelling assumptions are varied.
```{r Adult to Child Social Transmission, echo=F, message=F, error=F, warning=F,  fig.width=1.6*2*3,fig.height=1*4*3}
# Confirm units
# lsa_bmi_df %>%
#     filter(focus.title=="Adult to Adult Social Transmission of DIET Behaviors" ) %>%
#   select(input.value, `2057`)
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="Adult to Child Social Transmission DIET Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Child Social Transmission of dietary Behaviors", subtitle = "Units: per 1% change in correlation betwee age groups")+
  
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="Adult to Child Social Transmission PAL Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Adult to Child Social Transmission of physical Behaviors", subtitle = "Units: per 1% change in correlation betwee age groups")+

  plot_layout(nrow = 2, guides = "collect") +
  plot_annotation(title = 'Adult to Child Role Modelling',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
  
```


# Child to Child Social Transmission
```{r Child to Child Social Transmission, echo=F, message=F, error=F, warning=F,  fig.width=1.6*2*3,fig.height=1*4*3}
# Confirm units
# lsa_bmi_df %>%
#     filter(focus.title=="Adult to Adult Social Transmission of DIET Behaviors" ) %>%
#   select(input.value, `2057`)
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="Child to Child Social Transmission of DIET Behavior" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Child to Child Social Transmission of dietary Behaviors", subtitle = "Units: per 1% change in correlation betwee age groups")+
  
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="Child to Child Social Transmission of PAL Behaviors" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1% additional correlation (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("BMI outcomes"))+
  ggtitle("Child to Child Social Transmission of physical Behaviors", subtitle = "Units: per 1% change in correlation betwee age groups")+

  plot_layout(nrow = 2, guides = "collect") +
  plot_annotation(title = 'Child to Child Role Modelling',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
  
```



# Infant Reported behaviours

```{r Infant Reported behaviours, echo=F, message=F, error=F, warning=F, fig.width=1.6*2*2.5,fig.height=1*6*2.5}
# Confirm units
# lsa_bmi_df %>%
  # filter(focus.title=="\"Percentage TV >1 per day reported\"" ) %>%
  # select(input.value, `2057`)

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="\"Percentage BF >6mths reported\"" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Percentage of mothers breastfeeding to 6 months", subtitle = "Units: per 1 percentage point change")+
  
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="\"Percentage non-core > 0 reported\"" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Percentage of infants consuming non-core foods", subtitle = "Units: per 1 percentage point change")+
  
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="\"Percentage TV >1 per day reported\"" ) %>%
    ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Percentage of infants watching TV more than 1 hr/day", subtitle = "Units: per 1 percentage point change")+
  
  plot_layout(nrow = 3, ncol=1, guides = "collect") +
  plot_annotation(title = 'Infant behaviours',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")


```

# Intergenerational OR effects
```{r Intergenerational OR effects, echo=F, message=F, error=F, warning=F, fig.width=1.6*2*2.7,fig.height=1*10*2.7}
# Confirm units
# lsa_bmi_df %>%
# filter(focus.title=="\"Percentage TV >1 per day reported\"" ) %>%
# select(input.value, `2057`)


derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title=="Intercept" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Intercept", subtitle = "Units: per 0.01 intercept units")+
  
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="Parents BMI" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Impact of parents BMI on infants weight", subtitle = "Units: per 0.01 odds ratio")+
  
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="Breastfeeding >=6mth" ) %>%
    ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Impact of breastfeeding on infants weight", subtitle = "Units: per 0.01 odds ratio")+
  
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="TV >=1" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Impact of TV on infants weight", subtitle = "Units: per 0.01 odds ratio")+
  
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="Non-core >0" ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`), row=vars(`BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 1 percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Impact of non-core foods on infants weight", subtitle = "Units: per 0.01 odds ratio")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") +
  plot_annotation(title = 'Logistic regression odds ratio',subtitle = "Odds of overweight or obesity at 2 years",
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) & 
  theme(legend.position = "bottom")


```


# Mortality ratios

```{r Mortality ratios, echo=F, message=F, error=F, warning=F, fig.width=1.6*3*2, fig.height=1*4*2}
derivative.lsa.combined %>%
  filter(focus.title=="BMI Hazards Ratios" ) %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`BMI input`), rows = vars(`BMI outcome`,`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 unit (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Hazards Ratios", subtitle = "Units: per 0.01 hazards ratio") +
    plot_annotation(title = 'Mortality',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")


```

# METs
```{r METs, echo=F, message=F, error=F, warning=F, warning=F, fig.width=1.6*4*2, fig.height=1.6*6*2}

left.margin=50

p.tmp1<-derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="INACTIVE METs") %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("METs - Inactivity", subtitle = "Units: per 0.01 MET units")
  
p.tmp2<-derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="SCREEN TIME METs") %>%
    ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("METs - Screen time", subtitle = "Units: per 0.01 MET units")
  
p.tmp3<-derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="SLEEP METs") %>%
    ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("METs - Sleep", subtitle = "Units: per 0.01 MET units")
  
p.tmp4<-derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="LIGHT PA METs") %>%
   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("METs - Light physical activity", subtitle = "Units: per 0.01 MET units")
  
p.tmp5<-derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="MODERATE PA METs") %>%
   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("METs - Moderate physical activity", subtitle = "Units: per 0.01 MET units")
  
p.tmp6<-derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>% 
  filter(focus.title=="VIGOROUS PA METs") %>%
   ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`, `BMI outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
    ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per 0.01 MET units (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   plot.margin=unit(c(5.5,5.5,5.5,left.margin), units = c("points")),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("METs - Vigorous physical activity", subtitle = "Units: per 0.01 MET units")
  



tmp.y.lab<-p.tmp1$labels$y
p.tmp1$labels$y<-"";p.tmp2$labels$y<-"";p.tmp3$labels$y<-"";p.tmp4$labels$y<-"";p.tmp5$labels$y<-"";p.tmp6$labels$y<-""

p.tmp1+p.tmp2+p.tmp3+p.tmp4+p.tmp5+p.tmp6+
  plot_layout(ncol=1, nrow = 6, guides = "collect") +
  plot_annotation(title = 'Metabolic Equivelence of Task (MET)',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) & 
  theme(legend.position = "bottom"); grid::grid.draw(grid::textGrob(tmp.y.lab, x = 0.03, rot = 90))


```


# LIGHT PA
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
  # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
  # filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>% 
  # select(input.value, int.value)
```

```{r Light PA male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="LIGHT PA"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Light physical activity - Intercept", subtitle = "Units: per minute")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Light physical activity - Age change", subtitle = "Units: per minute")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


```{r Light PA female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Light physical activity - Intercept", subtitle = "Units: per minute")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Light physical activity - Age change", subtitle = "Units: per minute")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

# MODERATE PA
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
# filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r MODERATE PA male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="MODERATE PA"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Moderate physical activity - Intercept", subtitle = "Units: per minute")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Moderate physical activity - Age change", subtitle = "Units: per minute")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


```{r MODERATE PA female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Moderate physical activity - Intercept", subtitle = "Units: per minute")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Moderate physical activity - Age change", subtitle = "Units: per minute")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


# VIGOROUS PA
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
# filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r VIGOROUS PA male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="VIGOROUS PA"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Vigorous physical activity - Intercept", subtitle = "Units: per minute")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Vigorous physical activity - Age change", subtitle = "Units: per minute")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


```{r VIGOROUS PA female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Vigorous physical activity - Intercept", subtitle = "Units: per minute")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Vigorous physical activity - Age change", subtitle = "Units: per minute")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


# SCREEN TIME
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
# filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r SCREEN TIME male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="SCREEN TIME"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Screen time use - Intercept", subtitle = "Units: per minute")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Screen time use - Age change", subtitle = "Units: per minute")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


```{r SCREEN TIME female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Screen time use - Intercept", subtitle = "Units: per minute")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Screen time use - Age change", subtitle = "Units: per minute")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


# SLEEP
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
# filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r SLEEP male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="SLEEP"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily minutes of sleep - Intercept", subtitle = "Units: per minute")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily minutes of sleep - Age change", subtitle = "Units: per minute")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


```{r SLEEP female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily minutes of sleep - Intercept", subtitle = "Units: per minute")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily minutes of sleep - Age change", subtitle = "Units: per minute")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```



# Fruit Reported Intake
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
# filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Fruit male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Fruit"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fruit - Intercept", subtitle = "Units: per gram")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fruit - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Fruit female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fruit - Intercept", subtitle = "Units: per gram")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fruit - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

# Vegetables Reported Intake
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
# filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Vegetables male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Vegetables"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Vegetables - Intercept", subtitle = "Units: per gram")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Vegetables - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Vegetables female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Vegetables - Intercept", subtitle = "Units: per gram")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Vegetables - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

# Grains Reported Intake
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
# filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Grains male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Grains"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Grains - Intercept", subtitle = "Units: per gram")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Grains - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Grains female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Grains - Intercept", subtitle = "Units: per gram")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Grains - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


# Dairy Reported Intake
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
# filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Dairy male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Dairy"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Dairy - Intercept", subtitle = "Units: per gram")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Dairy - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Dairy female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Dairy - Intercept", subtitle = "Units: per gram")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Dairy - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

# Meat and Protein Reported
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
# filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Meat and Protein male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Meat and Protein"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Meat and Protein - Intercept", subtitle = "Units: per gram")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Meat and Protein - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Meat and Protein female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Meat and Protein - Intercept", subtitle = "Units: per gram")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Meat and Protein - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


# Discretionary foods Reported
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
# filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Discretionary foods male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Discretionary foods"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Discretionary foods - Intercept", subtitle = "Units: per gram")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Discretionary foods - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Discretionary foods female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Discretionary foods - Intercept", subtitle = "Units: per gram")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Discretionary foods - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


# Fats and Oils Reported
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
# filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Fats and Oils male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Fats and Oils"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fats and Oils - Intercept", subtitle = "Units: per gram")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fats and Oils - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Fats and Oils female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fats and Oils - Intercept", subtitle = "Units: per gram")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Fats and Oils - Age change", subtitle = "Units: per gram")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


# Sugar based beverage Reported
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
# filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Sugar based beverage male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Sugar based beverage"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Sugar based beverage - Intercept", subtitle = "Units: per ml")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Sugar based beverage - Age change", subtitle = "Units: per ml")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Sugar based beverage female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Sugar based beverage - Intercept", subtitle = "Units: per ml")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Sugar based beverage - Age change", subtitle = "Units: per ml")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```


# Water Reported
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
# filter(focus.title==paste0("Daily ",tmp.focus, " minutes Reported INTERCEPT" )) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Water male, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
tmp.focus="Water"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Water - Intercept", subtitle = "Units: per ml")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Male') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Water - Age change", subtitle = "Units: per ml")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Male Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

```{r Water female, echo=F, message=F, error=F, warning=F, fig.width=1*4*2.6, fig.height=1*4*2.6}
derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake INTERCEPT" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Water - Intercept", subtitle = "Units: per ml")+
    
    
  derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus.title==paste0(tmp.focus, " Reported Intake AGE SLOPE" )) %>% 
  filter(`Gender input`=='Female') %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid2(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), rows = vars(`BMI input`), labeller = label_both)+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3 5", "18 19", "40 44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   strip.text.y = element_text(size = 6),
                   panel.spacing=unit(0, "mm"))+
  guides(colour = guide_legend("Scenarios"))+
  ggtitle("Daily consumption of Water - Age change", subtitle = "Units: per ml")+
  
  plot_layout(ncol=1, nrow = 2, guides = "collect") +
  plot_annotation(title = 'Variation in Female Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")),
                                 plot.subtitle = element_text(size = 12, hjust = 0.5))) &
  theme(legend.position = "bottom")

```

# Initial FM %
**Change in Males fat-mass % assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>% 
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males", subtitle = "Units: per %")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males with obesity", subtitle = "Units: per %")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male % Fat-mass',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females", subtitle = "Units: per %")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity", subtitle = "Units: per %")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male % Fat-mass',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Change in Female fat-mass % assumptions**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>% 
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males", subtitle = "Units: per %")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males with obesity", subtitle = "Units: per %")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male % Fat-mass',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females", subtitle = "Units: per %")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="Initial FM %" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity", subtitle = "Units: per %")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male % Fat-mass',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```


#  Proportion of nutrients within food group Inputs     
**Grains**
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Prop of nutrients within food group Grains, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Grains"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")

```

**Explaination plots**
```{r Prop of nutrients within food group Grains explain, echo=F, message=F, error=F, warning=F,  fig.width=1*5*2.2,fig.height=1*4*2.2}
tmp.food.group="Grains"

p.tmp1<-derivative.lsa.combined %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
    filter(age.groups.output!="Age 45 49") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1, show.legend = F)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario), show.legend = F)+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  # scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
  #                  labels=c("3-5", "18-19", "40-44"))+
  scale_x_discrete(breaks=c("Age 2","Age 3 5", "Age 6 8", "Age 9 11", "Age 12 14", "Age 15 17",
                            "Age 18 19", "Age 20 24","Age 25 29", "Age 30 34", "Age 35 39", "Age 40 44"),
                   labels=c("2", "3-5", "6-8", "9-11","12-14","15-17","18-19", "20-24", "25-29", "30-34", "35-39","40-44"))+
  # scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.01))+
  xlab("Age")+
  ylab(bquote(atop("Average change in the reduction in", " obesity from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in obesity from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   # strip.text.x = element_text(size = 6),
                   # strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7),
                   axis.title.y = element_text(size=8))+
  # guides(colour = guide_legend())+
  ggtitle("Outcome: Males with obesity")

p.tmp2<-plot.df %>% 
  rename("Gender input"="gender.input", "BMI outcome"="BMI output", "BMI input"="bmi.input", "Age input"="age.groups.input") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  # filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  # filter(`BMI input`=="Overweight" ) %>% 
  # filter(`Age input`=="Age 3 5") %>%
  filter(`Age output`!="Age 45 49") %>% 
  ggplot()+
  # geom_point(aes(x=input.value, y=diff, color=scenario))+
  geom_smooth(aes(x=input.value, y=diff, color=scenario), se=F, linewidth=0.5, span=0.3)+
  # geom_vline(aes(xintercept=initial.input, color="Initial assumption", linetype="Initial assumption", alpha="Initial assumption"))+
  # geom_vline(aes(xintercept=33, color="Initial assumption", linetype="Initial assumption", alpha="Initial assumption"))+
  facet_wrap(vars(`Age output`), ncol = 4, nrow=3)+
  # scale_linetype_manual(breaks = c("Initial assumption", "EPOCH", "CCI", "SI", "SVI", "SSB") ,
  #                       values = c(2,1,1,1,1,1))+
  # scale_alpha_manual(breaks = c("Initial assumption", "EPOCH", "CCI", "SI", "SVI", "SSB") ,
  #                       values = c(0.3,1,1,1,1,1))+
  # scale_colour_manual(breaks = c("Initial assumption", "EPOCH", "CCI", "SI", "SVI", "SSB") ,values = c("black", hue_pal()(5) ))+
  # geom_line(aes(x=input.value, y=diff, color=scenario))+
  # geom_line(aes(x=input.value, y=base.model.value), linetype="dashed")+
  facet_wrap(vars(`Age output`), scales="free", ncol = 4, nrow=3)+
  guides(colour = guide_legend("Scenario"),
         linetype = guide_legend("Scenario"),
         alpha = guide_legend("Scenario"))+
  scale_y_continuous(labels = scales::percent)+
  ylab("Change in the prevalence of obesity (%)")+xlab("Assumed proportion of carohydrates in grains")+
  theme_bw() +theme(legend.position = "bottom")

layout <- '
#AAAAA#
BBBBBBB
BBBBBBB
'
wrap_plots(A = p.tmp1, B = p.tmp2, design = layout)+
  plot_annotation(title = 'Explaination of plots',
                   theme = theme(plot.title = element_text(size = 16, face = c("bold")))) & 
  theme(legend.position = "bottom")

```




**Vegetables**
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Prop of nutrients within food group Vegetables, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Vegetables"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")

```


**Fruit**
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Prop of nutrients within food group Fruit, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Fruit"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Dairy**
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Prop of nutrients within food group Dairy, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Dairy"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")
```


**Meat**
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Prop of nutrients within food group Meat, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Meat"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Fats**
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Prop of nutrients within food group Fats, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*5*2.7}
tmp.food.group="Fats"

# derivative.lsa.combined %>%
#   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
#   facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
#   # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("Scenario"))+
#   ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 4, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',tmp.food.group),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")
```
**Discretionary foods**
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Prop of nutrients within food group Discretionary_foods, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Discretionary_foods"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',gsub("_", " ",tmp.food.group)),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")



```


**Miscellaneous (Other)**
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Prop of nutrients within food group Miscellaneous, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="Other"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',"Miscellaneous (Other)"),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")



```

**Non-sugar-sweetened beverages**
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Prop of nutrients within food group NonAlcoholic_beverage, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*6*2.7}
tmp.food.group="NonAlcoholic_beverage"

derivative.lsa.combined %>%
  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Dietary Fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 5, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',"Non-sugar-sweetened beverages"),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")



```


**Sugar-sweetened beverages**
```{r, echo=F, message=F, error=F, warning=F}
# plot.df %>%
# # filter(`BMI output`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
# # filter(`gender.input`=='Male' & `Age output`=="Age 3 5" & scenario=="SSB" & `BMI output`=="Overweight" & `Gender outcome`=="Male" & bmi.input=="Underweight & \n Healthy weight") %>%
# select(input.value, int.value)
```

```{r Prop of nutrients within food group Sugar_Sweetened_beverage, echo=F, message=F, error=F, warning=F,  fig.width=1*4*2.7,fig.height=1*2.5*2.7}
tmp.food.group="Sugar_Sweetened_beverage"

# derivative.lsa.combined %>%
#   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Carbohydrates",", " ,tmp.food.group,"]") ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
#   facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
#   # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("Scenario"))+
#   ggtitle("Carbohydrates", subtitle = "Units: per percentage point")+
#   
#   derivative.lsa.combined %>%
#    filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
#   filter(focus==paste0("Proportion of nutrients within food group Inputs[","Fats",", " ,tmp.food.group,"]") ) %>%
#   ggplot()+
#   geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
#   geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
#   facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
#   # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
#   scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
#                    labels=c("3-5", "18-19", "40-44"))+
#   scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
#   # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
#   xlab("Age outcomes")+
#   ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
#   theme_bw()+theme(legend.position = "bottom",
#                    panel.spacing=unit(0, "mm"),
#                    strip.text = element_text(size = 7),
#                    axis.text.x = element_text(size=6),
#                    axis.text.y = element_text(size=8))+
#   guides(colour = guide_legend("Scenario"))+
#   ggtitle("Dietary Fats", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Moisture",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Moisture", subtitle = "Units: per percentage point")+
  
  # derivative.lsa.combined %>%
  #  filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  # filter(focus==paste0("Proportion of nutrients within food group Inputs[","Protein",", " ,tmp.food.group,"]") ) %>%
  # ggplot()+
  # geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  # geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  # scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
  #                  labels=c("3-5", "18-19", "40-44"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  # xlab("Age outcomes")+
  # ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  # theme_bw()+theme(legend.position = "bottom",
  #                  panel.spacing=unit(0, "mm"),
  #                  strip.text = element_text(size = 7),
  #                  axis.text.x = element_text(size=6),
  #                  axis.text.y = element_text(size=8))+
  # guides(colour = guide_legend("Scenario"))+
  # ggtitle("Protein", subtitle = "Units: per percentage point")+
  
  derivative.lsa.combined %>%
   filter(`BMI outcome`!="Underweight & \n Healthy weight") %>%
  filter(focus==paste0("Proportion of nutrients within food group Inputs[","Sugars",", " ,tmp.food.group,"]") ) %>%
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  facet_grid(col=vars(`Gender outcome`,`BMI outcome`), scales = "free", labeller = label_both)+
  # facet_grid2(col=vars(`Gender outcome`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = scales::label_number(suffix = "%", scale =0.01, accuracy = 0.1))+
  # scale_y_continuous(labels = label_scientific( scale =0.01,suffix = "%"))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", "per percentage point (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text = element_text(size = 7),
                   axis.text.x = element_text(size=6),
                   axis.text.y = element_text(size=8))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Sugars", subtitle = "Units: per percentage point")+
  
  plot_layout(nrow = 2, ncol=1, guides = "collect") + 
  plot_annotation(title = paste0('Percentage of macro-nutrients within ',"Non-sugar-sweetened beverages"),
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.6, face = c("bold")))) & 
  theme(legend.position = "bottom")



```



# Initial BMI Prevalence Inputs

**Change in Male Initial BMI Prevalence**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>% 
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males", subtitle = "Units: per %")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males with obesity", subtitle = "Units: per %")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male Initial BMI Prevalence Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females", subtitle = "Units: per %")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Male') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity", subtitle = "Units: per %")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male Initial BMI Prevalence Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

**Change in Female Initial BMI Prevalence**
```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>% 
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Males", subtitle = "Units: per %")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Male') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 0.01))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Males with obesity", subtitle = "Units: per %")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male Initial BMI Prevalence Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```

```{r, echo=F, message=F, error=F, warning=F,  fig.width=1.6*7*1.2,fig.height=1*13*1.2}
derivative.lsa.combined %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="Overweight") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale = 1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Overweight Females", subtitle = "Units: per %")+
  
  derivative.lsa.combined %>%
  filter(focus.title=="Initial BMI Prevalence Inputs" ) %>%
  filter(`Gender input`=='Female') %>%
  filter(`Gender outcome`=='Female') %>%
  filter(`BMI outcome`=="With obesity") %>% 
  ggplot()+
  geom_point(aes(x=age.groups.output, y=mean.ee.alt, color=scenario), size=1)+
  geom_line(aes(x=as.numeric(age.groups.output), y=mean.ee.alt, color=scenario))+
  # facet_grid(col=vars(`BMI input`), rows= vars(`Age input`), scales = "free", labeller = label_both)+
  facet_grid2(col=vars(`BMI input`), rows = vars(`Age input`), scale="free", labeller = label_both, independent = "x")+
  scale_x_discrete(breaks=c("Age 3 5", "Age 18 19", "Age 40 44"),
                   labels=c("3-5", "18-19", "40-44"))+
  scale_y_continuous(labels = label_scientific( scale =1,suffix = "%"))+
  # scale_y_continuous(labels = scales::label_number(suffix = "%", scale =1, accuracy = 1))+
  xlab("Age outcomes")+
  ylab(bquote(atop("Average change in the reduction in", " prevalence from intervention(" *mu[EE]*")")))+
  # ylab(bquote(atop("Average change in prevalence from intervention", "per kg increase in body weight (" *mu[EE]*")")))+
  theme_bw()+theme(legend.position = "bottom",
                   panel.spacing=unit(0, "mm"),
                   axis.title.y =element_blank(),
                   strip.text.x = element_text(size = 6),
                   strip.text.y = element_text(size = 6),
                   axis.text.x = element_text(size=7),
                   axis.text.y = element_text(size=7))+
  guides(colour = guide_legend("Scenario"))+
  ggtitle("Outcome: Females with obesity", subtitle = "Units: per %")+
  
  plot_layout(nrow = 1, ncol=2, guides = "collect") +
  plot_annotation(title = 'Male Initial BMI Prevalence Inputs',
                   theme = theme(plot.title = element_text(size = 16, hjust = 0.5, face = c("bold")))) & 
  theme(legend.position = "bottom")
```



